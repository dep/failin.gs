<% title "Edit your account" %>

<div id="user_profile" class="edit">
  <div class="pic_area">
    <%= avatar_for @user, default: image_url("default_pic.png"), size: 200 %>
    <h2>Manage your avatar</h2>
    <p class="small">
      You can pull your image from other websites. Pick a service below to link your account and use that site's avatar.
    </p>
    <h4>Your networks</h4>
    <dl class="avatar_services">
      <% if @user.twitter_screen_name.blank? %>
        <dt>
          <%= link_to content_tag(:img, "", src: image_path("twitter_setup.png")), twitter_login_path %>
        </dt>
        <dd>
          <%= link_to "Link your Twitter Account", twitter_login_path %>
          <p>
            Authenticate your account with Twitter to use your Twitter profile pic on failin.gs.
          </p>
        </dd>
      <% else %>
        <dt>
          <%= tweetimage_for @user, size: 32 %>
        </dt>
        <dd>
          <%= link_to "Apply your Twitter icon", preferences_path(key: "avatar_service", value: "twitter"), method: :post, remote: true %>
          <p>
            Click the link above to apply your Twitter profile picture (<a href="#">unlink</a>).
          </p>
        </dd>
      <% end %>
      <dt>
        <%= gravatar_for @user, size: 32 %>
      </dt>
      <dd>
        <%= link_to "Apply your Gravatar icon", preferences_path(key: "avatar_service", value: "gravatar"), method: :post, remote: true %>
        <p>
          <a href="http://en.gravatar.com/site/signup" target="_blank">Set up</a> your Gravatar image now by linking your failin.gs email address.
        </p>
      </dd>
    </dl>
  </div>
  <% form_for @user, url: account_path do |f| %>
    <div class="user_details">
      <%= render "common/flash_message" %>

      <h3 class="mod_title">Your failin.gs settings</h3>
      <p class="small">
        Welcome private-beta user. Thanks for helping us test the site.
        We imagine there might be some bugs in here, so if you see something weird,
        use the green feedback tab on the left of the screen. In the meantime, pardon
        the dust!
      </p>
      <%= f.error_messages %>
      <h3>Security Question</h3>
      <%#= f.label :login, "Username:" #%>
      <%#= f.text_field :login, maxlength: User::LOGIN_LENGTH.max #%>

      <%= f.label :question, "Security question: (#{link_to 'Why we ask', '#', onclick: '$("box_important").appear(); return false;'})".html_safe %>
      <%= f.text_field :question %>

      <%= f.label :answer, "Security question response:" %>
      <%= f.text_field :answer %>
      <h3>Personal Information</h3>
      <p class="small">
        Optionally, you can enter your full name, which we use
        to identify you when you send your profile through our email tool.
      </p>
      <%= f.label :name, "Your full name (not shown on your profile):" %>
      <%= f.text_field :name %>

      <%= f.label :email, "Email address (also hidden):" %>
      <%= f.text_field :email %>

      <p class="small">
        Next, provide some additional details about yourself. Be descriptive, otherwise someone
        might not know who you are.
      </p>
      <%= f.label :location, "Location:" %>
      <%= f.text_field :location %>
      <%= f.label :about, "About me:" %>
      <%= f.text_area :about, rows: 5, cols: 80, maxlength: 500, onkeyup: "return ismaxlength(this)" %>

      <%= f.submit "Save all this" %>
    </div>

    <div class="announce rounded_box">
      <h2>Additional Settings</h2>
      <p class="small">
        Here are some additional settings
        for you. You can save your changes
        at the bottom of the page.
      </p>

      <%= f.label :password, "New password:" %>
      <%= f.password_field :password %>

      <%= f.label :password_confirmation, "Twice to be sure:" %>
      <%= f.password_field :password_confirmation %>

      <h2>Private Profile</h2>

      <%= f.check_box :private %>
      <% f.label :private, class: "checkbox" do %>
        I'm shy. Only let me see my feedback.
      <% end %>

      <h2>Email notifications</h2>

      <%= f.check_box :subscribe %>
      <% f.label :subscribe, class: "checkbox" do %>
        Let me know when someone posts something to my account.
      <% end %>

      <h2>Want to remove your account?</h2>
      <p>We'd be sad to see you go, but we understand that the truth hurts.</p>
      <blockquote class="drop_shadow">
        "I'll say. <%= link_to "Let me out", account_path, method: :delete, confirm: "Are you sure you want to do this? There is no undo and your profile will be gone forever." %>"
      </blockquote>
    </div>
  <% end %>
</div>
